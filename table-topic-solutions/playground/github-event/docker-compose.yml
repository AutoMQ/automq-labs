services:
  producer:
    build:
      context: ./github-event/producer
    container_name: github-event-producer
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=automq:9092
      - SCHEMA_REGISTRY_URL=http://schema-registry:8081


  debug:
    image: curlimages/curl
    container_name: github-event-debug
    command: ["sleep", "infinity"]

  marimo:
    image: tabulario/spark-iceberg
    container_name: github-event-marimo
    working_dir: /home/iceberg
    volumes:
      - ./github-event/notebooks:/home/iceberg/notebooks
    ports:
      - "2718:2718"
    environment:
      - AWS_ACCESS_KEY_ID=admin
      - AWS_SECRET_ACCESS_KEY=password
      - AWS_REGION=us-east-1
      - SPARK_DRIVER_MEMORY=2g
      - SPARK_EXECUTOR_MEMORY=2g
      - SPARK_LOCAL_IP=127.0.0.1
      - JAVA_OPTS=-Xmx2g
    entrypoint: [""]
    command: >
      bash -c "
      pip install marimo pandas schedule &&
      cd /home/iceberg/notebooks &&
      marimo run analysis.py --host 0.0.0.0 --port 2718
      "

