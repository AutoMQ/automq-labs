[0;34m[17:15:48][0m =========================================
[0;34m[17:15:48][0m Scale-Down Auto-Balancing Experiment
[0;34m[17:15:48][0m =========================================
[0;34m[17:15:48][0m Cleaning up existing environment...
time="2025-12-30T17:15:49+08:00" level=warning msg="/Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/docker-compose-with-metrics.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Volume scale-down_minio-data  Removing
 Volume scale-down_prometheus-data  Removing
 Volume scale-down_grafana-data  Removing
 Volume scale-down_grafana-data  Removed
 Volume scale-down_minio-data  Removed
 Volume scale-down_prometheus-data  Removed
[0;34m[17:15:54][0m Starting cluster with 3 brokers...
time="2025-12-30T17:15:54+08:00" level=warning msg="/Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/docker-compose-with-metrics.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Network automq_net_scaledown  Creating
 Network automq_net_scaledown  Created
 Volume "scale-down_minio-data"  Creating
 Volume "scale-down_minio-data"  Created
 Volume "scale-down_prometheus-data"  Creating
 Volume "scale-down_prometheus-data"  Created
 Volume "scale-down_grafana-data"  Creating
 Volume "scale-down_grafana-data"  Created
 Container renderer-scaledown  Creating
 Container minio-scaledown  Creating
 Container prometheus-scaledown  Creating
 Container minio-scaledown  Created
 Container mc-scaledown  Creating
 Container prometheus-scaledown  Created
 Container grafana-scaledown  Creating
 Container renderer-scaledown  Created
 Container mc-scaledown  Created
 Container automq-server3-scaledown  Creating
 Container automq-server1-scaledown  Creating
 Container automq-server2-scaledown  Creating
 Container grafana-scaledown  Created
 Container automq-server2-scaledown  Created
 Container automq-server1-scaledown  Created
 Container automq-server3-scaledown  Created
 Container minio-scaledown  Starting
 Container renderer-scaledown  Starting
 Container prometheus-scaledown  Starting
 Container prometheus-scaledown  Started
 Container grafana-scaledown  Starting
 Container minio-scaledown  Started
 Container renderer-scaledown  Started
 Container minio-scaledown  Waiting
 Container grafana-scaledown  Started
 Container minio-scaledown  Healthy
 Container mc-scaledown  Starting
 Container mc-scaledown  Started
 Container automq-server2-scaledown  Starting
 Container automq-server3-scaledown  Starting
 Container automq-server1-scaledown  Starting
 Container automq-server1-scaledown  Started
 Container automq-server2-scaledown  Started
 Container automq-server3-scaledown  Started
[0;34m[17:16:32][0m Waiting for brokers...
[0;32m[17:16:36] ‚úÖ Brokers ready![0m
[0;34m[17:16:36][0m Waiting for Grafana to be ready...
[0;32m[17:16:36] ‚úÖ Grafana is ready![0m
[0;34m[17:16:36][0m Creating topic with 12 partitions...
Error while executing topic command : Topic 'Optional[scaledown-test]' does not exist as expected
[2025-12-30 09:16:38,093] ERROR java.lang.IllegalArgumentException: Topic 'Optional[scaledown-test]' does not exist as expected
	at org.apache.kafka.tools.TopicCommand.ensureTopicExists(TopicCommand.java:218)
	at org.apache.kafka.tools.TopicCommand$TopicService.deleteTopic(TopicCommand.java:656)
	at org.apache.kafka.tools.TopicCommand.execute(TopicCommand.java:113)
	at org.apache.kafka.tools.TopicCommand.mainNoExit(TopicCommand.java:90)
	at org.apache.kafka.tools.TopicCommand.main(TopicCommand.java:85)
 (org.apache.kafka.tools.TopicCommand)
[0;34m[17:16:38][0m Waiting 10 seconds for topic deletion to complete...
Created topic scaledown-test.
[0;34m[17:16:53][0m Waiting 15 seconds for topic to be fully created...
[0;34m[17:17:08][0m Initial partition distribution (3 brokers):
Topic: scaledown-test	TopicId: xe-doLWvQhmIgDnbWDMCUg	PartitionCount: 12	ReplicationFactor: 1	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: scaledown-test	Partition: 0	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 1	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 2	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 3	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 4	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 5	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 6	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 7	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 8	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 9	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 10	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 11	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
[0;34m[17:17:11][0m Broker 0: 4, Broker 1: 4, Broker 2: 4
[0;34m[17:17:11][0m Waiting 60 seconds for metrics to accumulate...
[0;34m[17:18:11][0m Capturing screenshot: 01-before-scaledown
[0;34m[17:18:11][0m Waiting for metrics to stabilize before screenshot...
[0;34m[17:18:12][0m   Attempt 1/5: 4-4-4-
[0;34m[17:18:33][0m   Attempt 2/5: 4-4-4-
[0;32m[17:18:33] ‚úÖ Metrics stable at: 4-4-4-[0m
[0;34m[17:18:33][0m Querying partition metrics from brokers (01-before-scaledown)...
[0;34m[17:18:33][0m   Broker 0: 4 partitions
[0;34m[17:18:33][0m   Broker 1: 4 partitions
[0;34m[17:18:33][0m   Broker 2: 4 partitions
[0;34m[17:18:33][0m Distribution: 4 4 4 
[0;34m[17:18:33][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;32m[17:19:15] ‚úÖ Screenshot captured: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/01-before-scaledown-20251230-171548.png (24966 bytes)[0m
[0;34m[17:19:15][0m Verifying metrics match screenshot...
[0;34m[17:19:15][0m Querying partition metrics from brokers (01-before-scaledown-verification)...
[0;34m[17:19:16][0m   Broker 0: 4 partitions
[0;34m[17:19:16][0m   Broker 1: 4 partitions
[0;34m[17:19:17][0m   Broker 2: 4 partitions
[0;34m[17:19:17][0m Distribution: 4 4 4 
[0;34m[17:19:17][0m Starting traffic...
2b9db5939fda6757b7eaf9f884e0fe28f26175d46c066030240dcbbda013c460
[0;32m[17:19:18] ‚úÖ Traffic started[0m
[0;34m[17:19:28][0m ‚¨áÔ∏è  SCALING DOWN - Stopping Broker 2...
automq-server3-scaledown
[0;31m[17:20:22] ‚ùå Broker 2 stopped at 17:20:22[0m
[0;34m[17:20:22][0m Monitoring for partition redistribution...
[0;34m[17:20:22][0m Check 1/30 - 17:20:22
[0;34m[17:20:51][0m Broker 0: 5, Broker 1: 7, Broker 2 (STOPPED): 0
[0;32m[17:20:51] ‚úÖ ‚úÖ REDISTRIBUTION DETECTED! All partitions moved off stopped broker[0m
[0;34m[17:20:51][0m Distribution: 5-7-0 (was 4-4-4)
[0;34m[17:21:21][0m Capturing screenshot: 02-redistribution-detected
[0;34m[17:21:21][0m Waiting for metrics to stabilize before screenshot...
[0;34m[17:21:22][0m   Attempt 1/5: 5-7-0-
[0;34m[17:21:44][0m   Attempt 2/5: 5-7-0-
[0;32m[17:21:44] ‚úÖ Metrics stable at: 5-7-0-[0m
[0;34m[17:21:44][0m Querying partition metrics from brokers (02-redistribution-detected)...
[0;34m[17:21:44][0m   Broker 0: 5 partitions
[0;34m[17:21:44][0m   Broker 1: 7 partitions
[0;34m[17:21:44][0m   Broker 2: 0 partitions (stopped)
[0;34m[17:21:44][0m Distribution: 5 7 0 
[0;34m[17:21:44][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;32m[17:22:39] ‚úÖ Screenshot captured: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/02-redistribution-detected-20251230-171548.png (32094 bytes)[0m
[0;34m[17:22:39][0m Verifying metrics match screenshot...
[0;34m[17:22:39][0m Querying partition metrics from brokers (02-redistribution-detected-verification)...
[0;34m[17:22:54][0m   Broker 0: 0 partitions
[0;34m[17:22:54][0m   Broker 1: 0 partitions (stopped)
[0;34m[17:22:54][0m   Broker 2: 0 partitions (stopped)
[0;34m[17:22:54][0m Distribution: 0 0 0 
[0;34m[17:23:24][0m Check 2/30 - 17:23:24
