[0;34m[15:20:41][0m =========================================
[0;34m[15:20:41][0m Scale-Down Auto-Balancing Experiment
[0;34m[15:20:41][0m =========================================
[0;34m[15:20:41][0m Cleaning up existing environment...
time="2025-12-30T15:20:41+08:00" level=warning msg="/Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/docker-compose-with-metrics.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Volume scale-down_minio-data  Removing
 Volume scale-down_prometheus-data  Removing
 Volume scale-down_grafana-data  Removing
 Volume scale-down_minio-data  Removed
 Volume scale-down_prometheus-data  Removed
 Volume scale-down_grafana-data  Removed
[0;34m[15:20:46][0m Starting cluster with 3 brokers...
time="2025-12-30T15:20:46+08:00" level=warning msg="/Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/docker-compose-with-metrics.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Network automq_net_scaledown  Creating
 Network automq_net_scaledown  Created
 Volume "scale-down_minio-data"  Creating
 Volume "scale-down_minio-data"  Created
 Volume "scale-down_prometheus-data"  Creating
 Volume "scale-down_prometheus-data"  Created
 Volume "scale-down_grafana-data"  Creating
 Volume "scale-down_grafana-data"  Created
 Container prometheus-scaledown  Creating
 Container renderer-scaledown  Creating
 Container minio-scaledown  Creating
 Container minio-scaledown  Created
 Container renderer-scaledown  Created
 Container mc-scaledown  Creating
 Container prometheus-scaledown  Created
 Container grafana-scaledown  Creating
 Container mc-scaledown  Created
 Container automq-server2-scaledown  Creating
 Container automq-server3-scaledown  Creating
 Container automq-server1-scaledown  Creating
 Container grafana-scaledown  Created
 Container automq-server3-scaledown  Created
 Container automq-server2-scaledown  Created
 Container automq-server1-scaledown  Created
 Container prometheus-scaledown  Starting
 Container renderer-scaledown  Starting
 Container minio-scaledown  Starting
 Container renderer-scaledown  Started
 Container minio-scaledown  Started
 Container minio-scaledown  Waiting
 Container prometheus-scaledown  Started
 Container grafana-scaledown  Starting
 Container grafana-scaledown  Started
 Container minio-scaledown  Healthy
 Container mc-scaledown  Starting
 Container mc-scaledown  Started
 Container automq-server3-scaledown  Starting
 Container automq-server1-scaledown  Starting
 Container automq-server2-scaledown  Starting
 Container automq-server2-scaledown  Started
 Container automq-server3-scaledown  Started
 Container automq-server1-scaledown  Started
[0;34m[15:21:23][0m Waiting for brokers...
[0;32m[15:21:25] ‚úÖ Brokers ready![0m
[0;34m[15:21:25][0m Waiting for Grafana to be ready...
[0;32m[15:21:25] ‚úÖ Grafana is ready![0m
[0;34m[15:21:25][0m Creating topic with 12 partitions...
Error while executing topic command : Topic 'Optional[scaledown-test]' does not exist as expected
[2025-12-30 07:21:27,220] ERROR java.lang.IllegalArgumentException: Topic 'Optional[scaledown-test]' does not exist as expected
	at org.apache.kafka.tools.TopicCommand.ensureTopicExists(TopicCommand.java:218)
	at org.apache.kafka.tools.TopicCommand$TopicService.deleteTopic(TopicCommand.java:656)
	at org.apache.kafka.tools.TopicCommand.execute(TopicCommand.java:113)
	at org.apache.kafka.tools.TopicCommand.mainNoExit(TopicCommand.java:90)
	at org.apache.kafka.tools.TopicCommand.main(TopicCommand.java:85)
 (org.apache.kafka.tools.TopicCommand)
[0;34m[15:21:27][0m Waiting 10 seconds for topic deletion to complete...
Created topic scaledown-test.
[0;34m[15:21:39][0m Waiting 15 seconds for topic to be fully created...
[0;34m[15:21:54][0m Initial partition distribution (3 brokers):
Topic: scaledown-test	TopicId: TDDfxMcJTDe3CxUTMHkjAw	PartitionCount: 12	ReplicationFactor: 1	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: scaledown-test	Partition: 0	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 1	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 2	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 3	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 4	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 5	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 6	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 7	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 8	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 9	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 10	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 11	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
[0;34m[15:21:56][0m Broker 0: 4, Broker 1: 4, Broker 2: 4
[0;34m[15:21:56][0m Waiting 60 seconds for metrics to accumulate...
[0;34m[15:22:56][0m Capturing screenshot: 01-before-scaledown
[0;34m[15:22:56][0m Waiting for metrics to stabilize before screenshot...
[0;34m[15:22:56][0m   Attempt 1/5: 4-4-4-
[0;34m[15:23:17][0m   Attempt 2/5: 4-4-4-
[0;32m[15:23:17] ‚úÖ Metrics stable at: 4-4-4-[0m
[0;34m[15:23:17][0m Querying partition metrics from brokers (01-before-scaledown)...
[0;34m[15:23:17][0m   Broker 0: 4 partitions
[0;34m[15:23:17][0m   Broker 1: 4 partitions
[0;34m[15:23:17][0m   Broker 2: 4 partitions
[0;34m[15:23:17][0m Distribution: 4 4 4 
[0;34m[15:23:17][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;31m[15:23:47] ‚ùå Screenshot too small: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/01-before-scaledown-20251230-152041.png (343 bytes) - likely 'no data'[0m
[0;34m[15:23:47][0m Starting traffic...
6c5f9e77ed40edf4963368540835ef1530e305bfe7e2a727735f6ad1980b15d9
[0;32m[15:23:47] ‚úÖ Traffic started[0m
[0;34m[15:23:57][0m ‚¨áÔ∏è  SCALING DOWN - Stopping Broker 2...
automq-server3-scaledown
[0;31m[15:24:16] ‚ùå Broker 2 stopped at 15:24:16[0m
[0;34m[15:24:16][0m Monitoring for partition redistribution...
[0;34m[15:24:16][0m Check 1/30 - 15:24:16
[0;34m[15:24:18][0m Broker 0: 2, Broker 1: 10, Broker 2 (STOPPED): 0
[0;32m[15:24:18] ‚úÖ ‚úÖ REDISTRIBUTION DETECTED! All partitions moved off stopped broker[0m
[0;34m[15:24:18][0m Distribution: 2-10-0 (was 4-4-4)
[0;34m[15:24:48][0m Capturing screenshot: 02-during-scaledown
[0;34m[15:24:48][0m Waiting for metrics to stabilize before screenshot...
[0;34m[15:24:48][0m   Attempt 1/5: 2-7-0-
[0;34m[15:25:09][0m   Attempt 2/5: 2-6-0-
[0;34m[15:25:29][0m   Attempt 3/5: 6-6-0-
[0;34m[15:25:49][0m   Attempt 4/5: 6-6-0-
[0;32m[15:25:49] ‚úÖ Metrics stable at: 6-6-0-[0m
[0;34m[15:25:49][0m Querying partition metrics from brokers (02-during-scaledown)...
[0;34m[15:25:49][0m   Broker 0: 6 partitions
[0;34m[15:25:49][0m   Broker 1: 6 partitions
[0;34m[15:25:50][0m   Broker 2: 0 partitions
[0;34m[15:25:50][0m Distribution: 6 6 0 
[0;34m[15:25:50][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;31m[15:26:20] ‚ùå Screenshot too small: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/02-during-scaledown-20251230-152041.png (343 bytes) - likely 'no data'[0m
[0;34m[15:26:50][0m Check 2/30 - 15:26:50
[0;34m[15:26:54][0m Broker 0: 6, Broker 1: 6, Broker 2 (STOPPED): 0
[0;32m[15:26:54] ‚úÖ ‚úÖ BALANCED! Partitions evenly distributed across remaining brokers[0m
[0;34m[15:27:24][0m Capturing screenshot: 03-after-scaledown
[0;34m[15:27:24][0m Waiting for metrics to stabilize before screenshot...
[0;34m[15:27:28][0m   Attempt 1/5: 0-0-0-
[0;34m[15:27:48][0m   Attempt 2/5: 0-0-0-
[0;32m[15:27:48] ‚úÖ Metrics stable at: 0-0-0-[0m
[0;34m[15:27:48][0m Querying partition metrics from brokers (03-after-scaledown)...
[0;34m[15:27:48][0m   Broker 0: 0 partitions
[0;34m[15:27:48][0m   Broker 1: 0 partitions
[0;34m[15:27:48][0m   Broker 2: 0 partitions
[0;34m[15:27:48][0m Distribution: 0 0 0 
[0;34m[15:27:48][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;31m[15:28:18] ‚ùå Screenshot too small: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/03-after-scaledown-20251230-152041.png (343 bytes) - likely 'no data'[0m
[0;34m[15:28:18][0m Stopping traffic...
scaledown-producer-20251230-152041
scaledown-producer-20251230-152041
[0;34m[15:28:29][0m Final partition distribution (2 brokers):
