[0;34m[17:05:39][0m =========================================
[0;34m[17:05:39][0m Scale-Down Auto-Balancing Experiment
[0;34m[17:05:39][0m =========================================
[0;34m[17:05:39][0m Cleaning up existing environment...
time="2025-12-30T17:05:39+08:00" level=warning msg="/Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/docker-compose-with-metrics.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Volume scale-down_minio-data  Removing
 Volume scale-down_grafana-data  Removing
 Volume scale-down_prometheus-data  Removing
 Volume scale-down_minio-data  Removed
 Volume scale-down_prometheus-data  Removed
 Volume scale-down_grafana-data  Removed
[0;34m[17:05:45][0m Starting cluster with 3 brokers...
time="2025-12-30T17:05:45+08:00" level=warning msg="/Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/docker-compose-with-metrics.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 Network automq_net_scaledown  Creating
 Network automq_net_scaledown  Created
 Volume "scale-down_prometheus-data"  Creating
 Volume "scale-down_prometheus-data"  Created
 Volume "scale-down_grafana-data"  Creating
 Volume "scale-down_grafana-data"  Created
 Volume "scale-down_minio-data"  Creating
 Volume "scale-down_minio-data"  Created
 Container prometheus-scaledown  Creating
 Container minio-scaledown  Creating
 Container renderer-scaledown  Creating
 Container prometheus-scaledown  Created
 Container grafana-scaledown  Creating
 Container renderer-scaledown  Created
 Container minio-scaledown  Created
 Container mc-scaledown  Creating
 Container grafana-scaledown  Created
 Container mc-scaledown  Created
 Container automq-server3-scaledown  Creating
 Container automq-server2-scaledown  Creating
 Container automq-server1-scaledown  Creating
 Container automq-server3-scaledown  Created
 Container automq-server2-scaledown  Created
 Container automq-server1-scaledown  Created
 Container minio-scaledown  Starting
 Container renderer-scaledown  Starting
 Container prometheus-scaledown  Starting
 Container prometheus-scaledown  Started
 Container grafana-scaledown  Starting
 Container renderer-scaledown  Started
 Container minio-scaledown  Started
 Container minio-scaledown  Waiting
 Container grafana-scaledown  Started
 Container minio-scaledown  Healthy
 Container mc-scaledown  Starting
 Container mc-scaledown  Started
 Container automq-server1-scaledown  Starting
 Container automq-server2-scaledown  Starting
 Container automq-server3-scaledown  Starting
 Container automq-server1-scaledown  Started
 Container automq-server2-scaledown  Started
 Container automq-server3-scaledown  Started
[0;34m[17:06:22][0m Waiting for brokers...
[0;32m[17:06:25] ‚úÖ Brokers ready![0m
[0;34m[17:06:25][0m Waiting for Grafana to be ready...
[0;32m[17:06:25] ‚úÖ Grafana is ready![0m
[0;34m[17:06:25][0m Creating topic with 12 partitions...
Error while executing topic command : Topic 'Optional[scaledown-test]' does not exist as expected
[2025-12-30 09:06:27,428] ERROR java.lang.IllegalArgumentException: Topic 'Optional[scaledown-test]' does not exist as expected
	at org.apache.kafka.tools.TopicCommand.ensureTopicExists(TopicCommand.java:218)
	at org.apache.kafka.tools.TopicCommand$TopicService.deleteTopic(TopicCommand.java:656)
	at org.apache.kafka.tools.TopicCommand.execute(TopicCommand.java:113)
	at org.apache.kafka.tools.TopicCommand.mainNoExit(TopicCommand.java:90)
	at org.apache.kafka.tools.TopicCommand.main(TopicCommand.java:85)
 (org.apache.kafka.tools.TopicCommand)
[0;34m[17:06:27][0m Waiting 10 seconds for topic deletion to complete...
Created topic scaledown-test.
[0;34m[17:06:40][0m Waiting 15 seconds for topic to be fully created...
[0;34m[17:06:55][0m Initial partition distribution (3 brokers):
Topic: scaledown-test	TopicId: MHarle-6RbeUFGG9Mu9nBw	PartitionCount: 12	ReplicationFactor: 1	Configs: min.insync.replicas=1,segment.bytes=1073741824
	Topic: scaledown-test	Partition: 0	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 1	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 2	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 3	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 4	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 5	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 6	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 7	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 8	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 9	Leader: 0	Replicas: 0	Isr: 0	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 10	Leader: 2	Replicas: 2	Isr: 2	Elr: 	LastKnownElr: 
	Topic: scaledown-test	Partition: 11	Leader: 1	Replicas: 1	Isr: 1	Elr: 	LastKnownElr: 
[0;34m[17:06:57][0m Broker 0: 4, Broker 1: 4, Broker 2: 4
[0;34m[17:06:57][0m Waiting 60 seconds for metrics to accumulate...
[0;34m[17:07:57][0m Capturing screenshot: 01-before-scaledown
[0;34m[17:07:57][0m Waiting for metrics to stabilize before screenshot...
[0;34m[17:07:57][0m   Attempt 1/5: 4-4-4-
[0;34m[17:08:17][0m   Attempt 2/5: 4-4-4-
[0;32m[17:08:17] ‚úÖ Metrics stable at: 4-4-4-[0m
[0;34m[17:08:17][0m Querying partition metrics from brokers (01-before-scaledown)...
[0;34m[17:08:18][0m   Broker 0: 4 partitions
[0;34m[17:08:18][0m   Broker 1: 4 partitions
[0;34m[17:08:18][0m   Broker 2: 4 partitions
[0;34m[17:08:18][0m Distribution: 4 4 4 
[0;34m[17:08:18][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;32m[17:08:55] ‚úÖ Screenshot captured: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/01-before-scaledown-20251230-170539.png (25285 bytes)[0m
[0;34m[17:08:55][0m Verifying metrics match screenshot...
[0;34m[17:08:55][0m Querying partition metrics from brokers (01-before-scaledown-verification)...
[0;34m[17:08:56][0m   Broker 0: 4 partitions
[0;34m[17:08:57][0m   Broker 1: 4 partitions
[0;34m[17:08:58][0m   Broker 2: 4 partitions
[0;34m[17:08:58][0m Distribution: 4 4 4 
[0;34m[17:08:58][0m Starting traffic...
7da4ba024c2c5fe01b2ac9b82dc2c85836121cf1b72b0f805eba7944806da8ff
[0;32m[17:08:58] ‚úÖ Traffic started[0m
[0;34m[17:09:08][0m ‚¨áÔ∏è  SCALING DOWN - Stopping Broker 2...
automq-server3-scaledown
[0;31m[17:09:28] ‚ùå Broker 2 stopped at 17:09:28[0m
[0;34m[17:09:28][0m Monitoring for partition redistribution...
[0;34m[17:09:28][0m Check 1/30 - 17:09:28
[0;34m[17:09:39][0m Broker 0: 7, Broker 1: 5, Broker 2 (STOPPED): 0
[0;32m[17:09:39] ‚úÖ ‚úÖ REDISTRIBUTION DETECTED! All partitions moved off stopped broker[0m
[0;34m[17:09:39][0m Distribution: 7-5-0 (was 4-4-4)
[0;34m[17:10:09][0m Capturing screenshot: 02-during-scaledown
[0;34m[17:10:09][0m Waiting for metrics to stabilize before screenshot...
[0;34m[17:10:10][0m   Attempt 1/5: 6-5-0-
[0;34m[17:10:32][0m   Attempt 2/5: 6-6-0-
[0;34m[17:10:53][0m   Attempt 3/5: 6-6-0-
[0;32m[17:10:53] ‚úÖ Metrics stable at: 6-6-0-[0m
[0;34m[17:10:53][0m Querying partition metrics from brokers (02-during-scaledown)...
[0;34m[17:10:53][0m   Broker 0: 6 partitions
[0;34m[17:10:53][0m   Broker 1: 6 partitions
[0;34m[17:10:53][0m   Broker 2: 0 partitions (stopped)
[0;34m[17:10:53][0m Distribution: 6 6 0 
[0;34m[17:10:53][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;32m[17:11:34] ‚úÖ Screenshot captured: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/02-during-scaledown-20251230-170539.png (35389 bytes)[0m
[0;34m[17:11:34][0m Verifying metrics match screenshot...
[0;34m[17:11:34][0m Querying partition metrics from brokers (02-during-scaledown-verification)...
[0;34m[17:11:34][0m   Broker 0: 6 partitions
[0;34m[17:11:34][0m   Broker 1: 6 partitions
[0;34m[17:11:35][0m   Broker 2: 0 partitions (stopped)
[0;34m[17:11:35][0m Distribution: 6 6 0 
[0;34m[17:12:05][0m Check 2/30 - 17:12:05
[0;34m[17:12:10][0m Broker 0: 6, Broker 1: 6, Broker 2 (STOPPED): 0
[0;32m[17:12:10] ‚úÖ ‚úÖ BALANCED! Partitions evenly distributed across remaining brokers[0m
[0;34m[17:12:10][0m Waiting 60 seconds for Prometheus to update (stopped broker data to expire)...
[0;34m[17:13:10][0m Capturing screenshot: 03-after-scaledown
[0;34m[17:13:10][0m Waiting for metrics to stabilize before screenshot...
[0;34m[17:13:10][0m   Attempt 1/5: 0-0-0-
[0;34m[17:13:30][0m   Attempt 2/5: 0-0-0-
[0;32m[17:13:30] ‚úÖ Metrics stable at: 0-0-0-[0m
[0;34m[17:13:30][0m Querying partition metrics from brokers (03-after-scaledown)...
[0;34m[17:13:30][0m   Broker 0: 0 partitions (stopped)
[0;34m[17:13:30][0m   Broker 1: 0 partitions (stopped)
[0;34m[17:13:30][0m   Broker 2: 0 partitions (stopped)
[0;34m[17:13:30][0m Distribution: 0 0 0 
[0;34m[17:13:30][0m Waiting 30 seconds for Prometheus scrape and Grafana update...
[0;32m[17:14:07] ‚úÖ Screenshot captured: /Users/keqing/IdeaProjects/automq-labs/auto-balancing-demos/scale-down/results/screenshots/03-after-scaledown-20251230-170539.png (35857 bytes)[0m
[0;34m[17:14:07][0m Verifying metrics match screenshot...
[0;34m[17:14:07][0m Querying partition metrics from brokers (03-after-scaledown-verification)...
[0;34m[17:14:07][0m   Broker 0: 0 partitions (stopped)
[0;34m[17:14:07][0m   Broker 1: 0 partitions (stopped)
[0;34m[17:14:07][0m   Broker 2: 0 partitions (stopped)
[0;34m[17:14:07][0m Distribution: 0 0 0 
[0;34m[17:14:07][0m Stopping traffic...
scaledown-producer-20251230-170539
scaledown-producer-20251230-170539
[0;34m[17:14:17][0m Final partition distribution (2 brokers):
